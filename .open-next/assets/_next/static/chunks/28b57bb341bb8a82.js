(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54683,e=>{"use strict";var t=e.i(43476),r=e.i(71645);async function s(e,t,r=[]){try{if(!e?.DB)throw Error("⚠️ Missing D1 binding — ensure `DB` is defined in wrangler.toml and Cloudflare project settings.");let s=e.DB.prepare(t).bind(...r),i=await s.all();return{results:i?.results||[],success:!0}}catch(e){return console.error("❌ D1 query error:",e,"\nQuery:",t,"\nParams:",r),{results:[],success:!1}}}let i={storage:{provider:"r2"},limits:{guest:{maxUploadSizeMB:500,maxExpiryHours:24},userFree:{maxUploadSizeMB:500,maxExpiryHours:48},userPro:{maxUploadSizeMB:2e3,maxExpiryHours:168}},cleanup:{intervalHours:12}};async function l(e){let t=JSON.parse(JSON.stringify(i));try{let{results:r}=await s(e,"SELECT key, value FROM settings");if(!r||0===r.length)return t;for(let e of r){let r=e.key.split("."),s=t;for(let e=0;e<r.length-1;e++)r[e]in s||(s[r[e]]={}),s=s[r[e]];let i=r[r.length-1],l=e.value;if("string"==typeof l){if(/^\d+$/.test(l))l=parseInt(l);else if(/^\d+\.\d+$/.test(l))l=parseFloat(l);else if("true"===l||"false"===l)l="true"===l;else if(l.startsWith("{")&&l.endsWith("}")||l.startsWith("[")&&l.endsWith("]"))try{l=JSON.parse(l)}catch{}}s[i]=l}return t}catch(e){return console.warn("⚠️ Failed to load settings from D1 (using defaults):",e),t}}async function n(e){return await l(e)}async function a(e,t,r){let s="string"==typeof e,l=s?e:t||"guest",a=s?t:r;if(s)return"guest"===l?i.limits.guest:"pro"===a?i.limits.userPro:i.limits.userFree;try{let t=await n(e);if("guest"===l)return t.limits.guest;if("pro"===a)return t.limits.userPro;return t.limits.userFree}catch(e){if(console.warn("⚠️ Failed to load runtime config, using BASE_CONFIG:",e),"guest"===l)return i.limits.guest;if("pro"===a)return i.limits.userPro;return i.limits.userFree}}async function o(e,t,r){let s=await a(e,t,r);return[1,6,12,24,48,168].filter(e=>e<=s.maxExpiryHours)}function u(){let[e,s]=(0,r.useState)(null),[l,n]=(0,r.useState)(""),[a,u]=(0,r.useState)(24),[d,c]=(0,r.useState)(5),[p,h]=(0,r.useState)(!1),[g,f]=(0,r.useState)(!1),[x,y]=(0,r.useState)(""),[m,j]=(0,r.useState)([]),v=i.limits.guest;(0,r.useEffect)(()=>{!async function(){j(await o("guest","free"))}()},[]);let S=async t=>{if(t.preventDefault(),!e)return alert("Select a file first.");let r=new FormData;r.append("file",e),r.append("expiry_hours",String(a)),r.append("max_downloads",String(d)),p&&r.append("one_time","1"),g&&(r.append("locked","1"),r.append("lock_key",x||""));let s=await fetch("/api/upload",{method:"POST",body:r}),i=await s.json();i.link?n(i.link):alert(i.error||"Upload failed")};return(0,t.jsxs)("div",{style:{padding:20},children:[(0,t.jsx)("h1",{children:"Upload a File"}),(0,t.jsxs)("p",{style:{color:"gray",marginBottom:10},children:["Max upload: ",v.maxUploadSizeMB,"MB | Max expiry: ",v.maxExpiryHours,"h"]}),(0,t.jsxs)("form",{onSubmit:S,children:[(0,t.jsx)("input",{type:"file",onChange:e=>s(e.target.files?.[0]||null)}),(0,t.jsxs)("div",{style:{marginTop:8},children:[(0,t.jsx)("label",{children:"Expiry:"}),(0,t.jsx)("select",{value:a,onChange:e=>u(Number(e.target.value)),children:m.map(e=>(0,t.jsx)("option",{value:e,children:e>=24?168===e?"7 days":`${e/24} days`:`${e} hours`},e))})]}),(0,t.jsxs)("div",{style:{marginTop:8},children:[(0,t.jsx)("label",{children:"Max downloads:"}),(0,t.jsxs)("select",{value:d,onChange:e=>c(Number(e.target.value)),children:[(0,t.jsx)("option",{value:1,children:"1"}),(0,t.jsx)("option",{value:3,children:"3"}),(0,t.jsx)("option",{value:5,children:"5"}),(0,t.jsx)("option",{value:0,children:"Unlimited"})]})]}),(0,t.jsx)("div",{style:{marginTop:8},children:(0,t.jsxs)("label",{children:[(0,t.jsx)("input",{type:"checkbox",checked:p,onChange:e=>h(e.target.checked)})," ","Delete after first download"]})}),(0,t.jsxs)("div",{style:{marginTop:8},children:[(0,t.jsxs)("label",{children:[(0,t.jsx)("input",{type:"checkbox",checked:g,onChange:e=>f(e.target.checked)})," ","Lock with key/password"]}),g&&(0,t.jsx)("div",{style:{marginTop:6},children:(0,t.jsx)("input",{placeholder:"Enter a key (min 4 chars)",value:x,onChange:e=>y(e.target.value)})})]}),(0,t.jsx)("button",{type:"submit",style:{marginTop:12},children:"Upload"})]}),l&&(0,t.jsxs)("div",{style:{marginTop:16},children:[(0,t.jsx)("p",{children:"File uploaded successfully:"}),(0,t.jsx)("a",{href:l,target:"_blank",rel:"noopener noreferrer",children:l})]})]})}e.s(["default",()=>u],54683)}]);