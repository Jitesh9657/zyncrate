module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},51937,a=>{"use strict";var b=a.i(87924),c=a.i(72131);async function d(a,b,c=[]){try{if(!a?.DB)throw Error("⚠️ Missing D1 binding — ensure `DB` is defined in wrangler.toml and Cloudflare project settings.");let d=a.DB.prepare(b).bind(...c),e=await d.all();return{results:e?.results||[],success:!0}}catch(a){return console.error("❌ D1 query error:",a,"\nQuery:",b,"\nParams:",c),{results:[],success:!1}}}let e={storage:{provider:"r2"},limits:{guest:{maxUploadSizeMB:500,maxExpiryHours:24},userFree:{maxUploadSizeMB:500,maxExpiryHours:48},userPro:{maxUploadSizeMB:2e3,maxExpiryHours:168}},cleanup:{intervalHours:12}};async function f(a){let b=JSON.parse(JSON.stringify(e));try{let{results:c}=await d(a,"SELECT key, value FROM settings");if(!c||0===c.length)return b;for(let a of c){let c=a.key.split("."),d=b;for(let a=0;a<c.length-1;a++)c[a]in d||(d[c[a]]={}),d=d[c[a]];let e=c[c.length-1],f=a.value;if("string"==typeof f){if(/^\d+$/.test(f))f=parseInt(f);else if(/^\d+\.\d+$/.test(f))f=parseFloat(f);else if("true"===f||"false"===f)f="true"===f;else if(f.startsWith("{")&&f.endsWith("}")||f.startsWith("[")&&f.endsWith("]"))try{f=JSON.parse(f)}catch{}}d[e]=f}return b}catch(a){return console.warn("⚠️ Failed to load settings from D1 (using defaults):",a),b}}async function g(a){return await f(a)}async function h(a,b,c){let d="string"==typeof a,f=d?a:b||"guest",h=d?b:c;if(d)return"guest"===f?e.limits.guest:"pro"===h?e.limits.userPro:e.limits.userFree;try{let b=await g(a);if("guest"===f)return b.limits.guest;if("pro"===h)return b.limits.userPro;return b.limits.userFree}catch(a){if(console.warn("⚠️ Failed to load runtime config, using BASE_CONFIG:",a),"guest"===f)return e.limits.guest;if("pro"===h)return e.limits.userPro;return e.limits.userFree}}async function i(a,b,c){let d=await h(a,b,c);return[1,6,12,24,48,168].filter(a=>a<=d.maxExpiryHours)}function j(){let[a,d]=(0,c.useState)(null),[f,g]=(0,c.useState)(""),[h,j]=(0,c.useState)(24),[k,l]=(0,c.useState)(5),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)([]),u=e.limits.guest;(0,c.useEffect)(()=>{!async function(){t(await i("guest","free"))}()},[]);let v=async b=>{if(b.preventDefault(),!a)return alert("Select a file first.");let c=new FormData;c.append("file",a),c.append("expiry_hours",String(h)),c.append("max_downloads",String(k)),m&&c.append("one_time","1"),o&&(c.append("locked","1"),c.append("lock_key",q||""));let d=await fetch("/api/upload",{method:"POST",body:c}),e=await d.json();e.link?g(e.link):alert(e.error||"Upload failed")};return(0,b.jsxs)("div",{style:{padding:20},children:[(0,b.jsx)("h1",{children:"Upload a File"}),(0,b.jsxs)("p",{style:{color:"gray",marginBottom:10},children:["Max upload: ",u.maxUploadSizeMB,"MB | Max expiry: ",u.maxExpiryHours,"h"]}),(0,b.jsxs)("form",{onSubmit:v,children:[(0,b.jsx)("input",{type:"file",onChange:a=>d(a.target.files?.[0]||null)}),(0,b.jsxs)("div",{style:{marginTop:8},children:[(0,b.jsx)("label",{children:"Expiry:"}),(0,b.jsx)("select",{value:h,onChange:a=>j(Number(a.target.value)),children:s.map(a=>(0,b.jsx)("option",{value:a,children:a>=24?168===a?"7 days":`${a/24} days`:`${a} hours`},a))})]}),(0,b.jsxs)("div",{style:{marginTop:8},children:[(0,b.jsx)("label",{children:"Max downloads:"}),(0,b.jsxs)("select",{value:k,onChange:a=>l(Number(a.target.value)),children:[(0,b.jsx)("option",{value:1,children:"1"}),(0,b.jsx)("option",{value:3,children:"3"}),(0,b.jsx)("option",{value:5,children:"5"}),(0,b.jsx)("option",{value:0,children:"Unlimited"})]})]}),(0,b.jsx)("div",{style:{marginTop:8},children:(0,b.jsxs)("label",{children:[(0,b.jsx)("input",{type:"checkbox",checked:m,onChange:a=>n(a.target.checked)})," ","Delete after first download"]})}),(0,b.jsxs)("div",{style:{marginTop:8},children:[(0,b.jsxs)("label",{children:[(0,b.jsx)("input",{type:"checkbox",checked:o,onChange:a=>p(a.target.checked)})," ","Lock with key/password"]}),o&&(0,b.jsx)("div",{style:{marginTop:6},children:(0,b.jsx)("input",{placeholder:"Enter a key (min 4 chars)",value:q,onChange:a=>r(a.target.value)})})]}),(0,b.jsx)("button",{type:"submit",style:{marginTop:12},children:"Upload"})]}),f&&(0,b.jsxs)("div",{style:{marginTop:16},children:[(0,b.jsx)("p",{children:"File uploaded successfully:"}),(0,b.jsx)("a",{href:f,target:"_blank",rel:"noopener noreferrer",children:f})]})]})}a.s(["default",()=>j],51937)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f4b3a73a._.js.map